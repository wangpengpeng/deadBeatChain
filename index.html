<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- PAGE settings -->
  <link rel="icon" href="https://templates.pingendo.com/assets/Pingendo_favicon.ico">
  <title>老赖黑名单</title>
  <meta name="description" content="Wireframe design of a landing page by Pingendo">
  <meta name="keywords" content="Pingendo bootstrap example template wireframe landing">
  <meta name="author" content="Pingendo">
      <script src=lib/jquery-3.3.1.min.js></script>
     <script src=lib/nebPay.js></script>
     <script src=lib/nebulas.js></script>  
  <!-- CSS dependencies -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" type="text/css">
  <link rel="stylesheet" href="wireframe.css"> </head>

<body class="">
  <nav class="navbar navbar-expand-md navbar-dark bg-info">
    <div class="container">
      <a class="navbar-brand" href="#">
        <i class="fa d-inline fa-lg fa-bullseye"></i>
      </a>
      <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbar2SupportedContent" aria-controls="navbar2SupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse text-center justify-content-between" id="navbar2SupportedContent">
        <ul class="navbar-nav">
          <li class="nav-item">
            <a class="nav-link mx-2" href="index.html">老赖黑名单首页</a>
          </li>
          <li class="nav-item">
            <a class="nav-link mx-2" href="commit.html">提交老赖名单</a>
          </li>
          <li class="nav-item">
            <a class="nav-link mx-2" href="about.html">关于我们</a>
          </li>
        </ul>
      </div>
    </div>
  </nav>
  <div class="py-5 text-white bg-primary text-center">
    <div class="container">
      <div class="row">
        <div class="col-md-12">
          <h1>请输入身份证号查询</h1>
        <div class="noExtension hide" id="noExtension">
            NOTE: 使用DeadBeatList前确保浏览器已安装插件 <a target="_blank" href="https://github.com/ChengOrangeJu/WebExtensionWallet">WebExtensionWallet</a>
        </div>
            <div class="input-group my-1">
              <input type="text" class="form-control mr-3 my-1" id="drive_number" placeholder="34122419902523205" id="inlineFormInputGroup">
            <button id="search">查询</button>
            </div>
        </div>
      </div>
    </div>
  </div>
  <div class="py-5">
    <div class="container">
      <div class="row">
        <div class="col-md-12">
          <table class="table" style="opacity: 0.5;">
            <thead>
              <tr>
                <th>#</th>
                <th>身份证号</th>
                <th>欠款原因</th>
                <th>欠款时间</th>
            <!--     <th>时间</th> -->
                <th>评论人</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>1</td>
                <td>3412241**205</td>
                <td>2012年2月3日晚上，小明借给小王五万块钱，约定一年后还款，到期没有还款，已经逾期三年。典型老赖行为</td>
                <td>3年</td>
                <td>xxx</td>
              </tr>
              <tr>
                <td>2</td>
                <td>3412241**205</td>
                <td>2012年2月3日晚上，小明借给小王五万块钱，约定一年后还款，到期没有还款，已经逾期三年。典型老赖行为</td>
                <td>3年</td>
                <td>xxx</td>
              </tr>
              <tr>
                <td>3</td>
                <td>3412241**205</td>
                <td>2012年2月3日晚上，小明借给小王五万块钱，约定一年后还款，到期没有还款，已经逾期三年。典型老赖行为</td>
                <td>3年</td>
        <!--         <td>20180505</td> -->
                <td>xxx</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
  <div class="py-5">
    <div class="container">
      <div class="row">

        <div class="p-6 col-lg-6 col-md-6">
          <h4>诚信中国，信用为本</h4>
          <p>Paragraph - Credit China, credit based.</p>
        </div>
        <div class="p-6 col-lg-6 col-md-6">
          <h4>借钱不换，区块上链</h4>
          <p>Paragraph - Borrow money not to change, block up chain.</p>
        </div>

      </div>
    </div>
  </div>


  <div class="footer">
    <img width="60" height="60" src="./images/logo.png"><br> Copyright©2018
    <br>一个基于星云链的区块链的老赖黑名单平台。
  </div>

  <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
    <script>
 
	  var debug = false;
    //here we use neb.js to call the "get" function to search from the Dictionary
        var nebulas = require("nebulas"),
        Account = nebulas.Account,
        neb = new nebulas.Neb();
		
		if(debug){
           neb.setRequest(new nebulas.HttpRequest("http://testnet.nebulas.io/"));  //https://testnet.nebulas.io/  //https://mainnet.nebulas.io
		 }else{
           neb.setRequest(new nebulas.HttpRequest("https://mainnet.nebulas.io"));
		 }
        //to check if the extension is installed
        // $("#search").attr("disabled",true)


        //to check if the extension is installed
        //if the extension is installed, var "webExtensionWallet" will be injected in to web page
        if(typeof(webExtensionWallet) === "undefined"){
            //alert ("Extension wallet is not installed, please install it first.")
            $("#noExtension").removeClass("hide")
        }else{
            $("#search").attr("disabled",false)
        }

		if(debug){
			 var dappAddress =   "n1smyNN4KzNdpvm587sMZxZETQGS4jFEc6r" ; // n1S1Py3ERHi8EP4VVpPEbzZnihepQUJmFy9
		}else{
		     var dappAddress =   "n228P9qhiGnTNiP6H1CvF2E2V88mTbX9Fi5" ;//"idc n1e3SYencyWVCA3RVbGjYo2dXDkgDp2XveD";//"n1yP7SfG157R9ZQs3WpuDGTvmgxebh1rPtf";
		}
 
 
   
     $("#search").click(function(){
        // $("#search_value").val() 搜索框内的值
      var contractAddress = "";
      var from = Account.NewAccount().getAddressString();
      console.log(from);
      console.log("test get");
      callArgs = "[\"" + $("#drive_number").val() + "\", \""+ 0 + "\", \"" + 100+ "\"]";
      var contract = {
        "function": "query",
        "args": callArgs  
      };

        neb.api.call(from,dappAddress, "0", "0", "2000000", "2000000", contract).then(function (resp) {
            console.log("2222" +JSON.stringify(resp));
            cbSearch(resp);
             // alert(1111);
        }).catch(function (err) {
            console.log( "error:" + err.message);
          });

 

    });
 
     function cbSearch(resp) {
        var result = resp.result ;   ////resp is an object, resp.result is a JSON string
        console.log("return of rpc call: " + result);
         
         var commentArr =  JSON.parse(result)  ;
         var tabledata = "";
         for(var i = 0; i < commentArr.length; i++){
             if(commentArr[i] == "null")
             {
               continue;
             }
             var comment = JSON.parse(commentArr[i]);
             console.log(comment);
             console.log(comment.createtime + " " + comment.msg);
             var tabledata = tabledata + "<tr><td>" + i + "</td>"
                 +"<td>"+ comment.driveNumber+"</td>"
                 +"<td>"+ comment.msg+"</td>"
                +"<td>"+ comment.score+"</td>"
     /*            +"<td>"+ comment.createtime+"</td>"*/
                 +"<td>"+ comment.author+"</td>"
                 +"</tr>";
         }
         console.log(tabledata);
          $("tbody").html(tabledata);
 

      } 

</script> 
</body>

</html>